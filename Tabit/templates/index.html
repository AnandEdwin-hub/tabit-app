{% extends "base.html" %}
{% block content %}
<div class="text-center mb-4">
    <img src="{{ url_for('static', filename='tabit-icon.png') }}" alt="Tabit Icon" width="64" height="64">
    <h1 class="display-5 mt-2">Tabit</h1>
</div>

<!-- Show Existing Groups -->
{% if groups %}
<div class="mb-4">
    <h3>Your Groups</h3>
    {% for group in groups %}
    <div class="card mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    {% if group.photo %}
                    <img src="{{ url_for('static', filename='uploads/' + group.photo) }}" width="50" height="50" class="rounded me-2">
                    {% endif %}
                    <strong>{{ group.name }}</strong>
                    <br><small class="text-muted">Members: {{ group.members | join(', ') }}</small>
                </div>
                <div>
                    <a href="{{ url_for('expenses', group_id=group.id) }}" class="btn btn-sm btn-primary">Add Expenses</a>
                    <a href="{{ url_for('transactions', group_id=group.id) }}" class="btn btn-sm btn-success">View Split</a>
                    <button class="btn btn-sm btn-danger" onclick="confirmDelete({{ group.id }}, '{{ group.name }}')">Delete</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Create New Group -->
<div class="card mx-auto" style="max-width:400px;">
    <div class="card-body">
        <h3 class="card-title mb-3">Create a Group</h3>
        <form method="POST" enctype="multipart/form-data">
            <div class="mb-3">
                <label>Upload Group Photo (optional):</label>
                <input type="file" name="group_photo" accept="image/*" class="form-control">
            </div>
            <input type="text" name="group_name" placeholder="Group name" required class="form-control mb-3">
            <div id="members" class="mb-3">
                <label>Add members:</label>
                <input type="text" id="memberInput" class="form-control" placeholder="Member Name">
                <button type="button" class="btn btn-secondary mt-2" onclick="addMember()">Add</button>
                <ul id="membersList" class="mt-2"></ul>
                <input type="hidden" name="members" id="membersHidden">
            </div>
            <button class="btn btn-primary w-100 mt-2" type="submit">Create Group</button>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
    <div style="background:white; margin:15% auto; padding:20px; width:350px; border-radius:8px;">
        <h5>Delete Group?</h5>
        <p id="deleteMessage"></p>
        <form method="POST" id="deleteForm">
            <label>Your Name (for record):</label>
            <input type="text" name="deleter_name" required class="form-control mb-2">
            
            <div class="mt-3">
                <button type="submit" class="btn btn-danger">Confirm Delete</button>
                <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    let members = [];
    function addMember() {
        let name = document.getElementById('memberInput').value.trim();
        if(name) {
            members.push(name);
            document.getElementById('membersList').innerHTML += '<li>' + name + '</li>';
            document.getElementById('membersHidden').value = members.join(',');
            document.getElementById('memberInput').value = '';
        }
    }
    
    function confirmDelete(groupId, groupName) {
        document.getElementById('deleteMessage').innerText = 'Settle all dues before deleting "' + groupName + '"';
        document.getElementById('deleteForm').action = '/delete_group/' + groupId;
        document.getElementById('deleteModal').style.display = 'block';
    }
    
    function closeDeleteModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }
</script>
{% endblock %}
